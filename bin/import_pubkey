#!/bin/bash

# Get current dir (bin dir)
BIN_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
SSM_DIR="$BIN_DIR/.."
# Source setup support file
source "$SSM_DIR/lib/setup"

PUBKEY_DIR="$SSM_DIR/pubkeys"

keyid=$1
if [ -z $keyid ]; then
    echo "[ERROR] You must input a key ID, like so: bin/import_pubkey E1960A37"
    exit 1
fi
echo "[INFO] Importing key to pubkeys dir"
gpg --output "$PUBKEY_DIR/$keyid.pub" --export $keyid

echo "[INFO] Adding key ID to .ssm/gpg_keys"
echo $keyid >> $SSM_DIR/gpg_keys

echo "[DONE]"
