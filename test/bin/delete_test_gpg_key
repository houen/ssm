#!/bin/bash
# Author: SÃ¸ren Houen
# License: LGPL 3.0 https://www.gnu.org/licenses/lgpl-3.0.en.html
 
# Get key fingerprint
out=$(gpg --list-secret-keys --with-colons --fingerprint $SSM_TEST_KEY_NAME | grep -oE -A 1 'sec:.+')
out=$(echo $out | grep -oE 'fpr:+[^:]+')
out=$(echo $out | grep -oE ':+[^:]+')
fingerprint=$(echo $out | grep -oE '[^:]+')

# Check that fingerprint matches exactly one key
num_keys_with_fingerprint=$(gpg --list-secret-keys --with-colons --fingerprint $fingerprint | grep "sec:" | wc -l)
if [ $num_keys_with_fingerprint == 1 ]; then
  gpg -q --yes --batch --delete-secret-keys $fingerprint
  gpg -q --yes --batch --delete-keys $fingerprint
fi
